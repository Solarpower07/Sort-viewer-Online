<!DOCTYPE html>
<html>
    <head>
        <link href="./main.css" rel="stylesheet">
        <title>Sort Viewer Online</title>
    </head>
    <body>

        <div id="sort_container"></div>

        <div class="stats_container">
            <h2 class="stats">
                Comparisons: <span id="compares">0</span>
                <br>
                Swaps: <span id="swaps">0</span>
                <br>
                Reversals: <span id="reversals">0</span>
                <br>
                <br>
                Writes to main array: <span id="writes">0</span>
                <br>
                Writes to auxillary array(s): <span id="writes_aux">0</span>
                <br>
            </h2>
        </div>

        <script src="./scripts/main.js" type="text/javascript"></script>

        <script src="./scripts/sorts.js"></script>

        <script>

            const sort_container = document.getElementById('sort_container');

            sort = new Sort(256,(arr,values) => {

                let elements = [];
                    
                arr.forEach((v,i) => {
                    
                    sort_container.insertAdjacentHTML("beforeend",`
                        <div class="sort_element" id="element_${i}" style="height: calc( ( 100% / ${arr.length} ) * ${v} ); background-color: ${(arr.pointers[i]) ? "#f00" : "#fff"}; left: calc( ( 100% / ${arr.length} ) * ${i} ); width: calc( 100% / ${arr.length} )"></div>
                    `)

                    elements.push(document.getElementById(`element_${i}`).style);

                })

                let value_spots = {
                    compares: document.getElementById(`compares`),
                    swaps: document.getElementById(`swaps`),
                    reversals: document.getElementById(`reversals`),
                    writes: document.getElementById(`writes`),
                    writes_aux: document.getElementById(`writes_aux`)
                }

                return async (i) => {

                    value_spots.compares.innerHTML = values.compares;
                    value_spots.swaps.innerHTML = values.swaps;
                    value_spots.reversals.innerHTML = values.reversals;
                    value_spots.writes.innerHTML = values.writes;
                    value_spots.writes_aux.innerHTML = values.writes_aux;

                    if (typeof i === "number") {

                        const v = arr[i];

                        if (arr.verifying) {
                        
                            elements[i]["background-color"] = (arr.verified) ? "#0f0" : "#f00";
                        
                        }
                        else {
                        
                            elements[i].height = `calc( ( 100vh / ${arr.length} ) * ${v} )`;
                            elements[i]["background-color"] = (arr.pointers[i]) ? "#f00" : "#fff";
                        
                        }

                    }

                }

            })

            window.addEventListener('keydown', (event) => {
                if (event.code === "Escape") sort.toggle_pause();
            })

            setTimeout(async () => {
                await sort.shuffle();
                // await sort.write.invert();
                sort.values.reset();
                setTimeout(() => {
                    sort.initiate(sorts.cocktail);
                },750)
            }, 1500);

        </script>

    </body>
</html>